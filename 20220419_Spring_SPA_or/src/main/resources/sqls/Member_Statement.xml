<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.min.edu.model.mapper.MemberDaoImpl">

<!-- 회원 전체 조회 -->
<!-- <select id="selectMemberAll" resultType="MemberVo" > -->
<!--   SELECT ID, AUTH, ID||'님' AS NAME, DELFLAG, REGDATE FROM SPRINGMEMBER  -->
<!--   ORDER BY REGDATE DESC -->
<!-- </select> -->

<!-- 회원 가입 -->
<insert id="insertMember" parameterType="java.util.Map">
  INSERT INTO SPRINGMEMBER (ID,PW,AUTH,DELFLAG,REGDATE) VALUES (#{id},#{pw},'U','N',SYSDATE)
</insert>

<!-- 로그인 -->
<select id="loginMember" parameterType="java.util.Map" resultType="MemberVo">
  SELECT ID, AUTH,REGDATE FROM SPRINGMEMBER WHERE ID=#{id} AND PW=#{pw} AND DELFLAG ='N'
</select>

<!-- 비밀번호 확인 -->
<select id="passwordCheck" parameterType="java.lang.String" resultType="java.lang.String">
  SELECT PW
    FROM SPRINGMEMBER
      WHERE ID=#{id}
</select>

<!-- ID로그인 -->
<select id="enLogin" parameterType="java.lang.String" resultType="MemberVo">
  SELECT ID, AUTH,REGDATE FROM SPRINGMEMBER WHERE ID=#{id}
</select>

<!-- 상태 변경 -->
<update id="changeUser" parameterType="java.util.Map">
   UPDATE SPRINGMEMBER
           SET DELFLAG = CASE DELFLAG WHEN 'N' THEN 'Y' ELSE 'N' END 
           WHERE ID=#{id}
</update>

<!-- 아이디 중복 검사 -->
<select id="idCheck" parameterType="String" resultType="int">
  SELECT COUNT(*) FROM SPRINGMEMBER WHERE ID=#{id}
</select>

<!-- 회원 페이징 처리 -->
<select id="selectMemberAll" parameterType="RowNumVo" resultType="MemberVo">
    SELECT ID, AUTH, NAME, DELFLAG, REGDATE,ROWNUM
FROM(
		SELECT ROW_NUMBER() OVER(ORDER BY REGDATE DESC)RM, ID, AUTH, ID||'님' AS NAME, DELFLAG, REGDATE, ROWNUM
  		 FROM SPRINGMEMBER
      )
   WHERE RM BETWEEN #{start} AND #{last}
</select>

<!-- 회원 토탈count  --> 
<select id="memberTotal" resultType="int">
SELECT COUNT(*) FROM SPRINGMEMBER
</select>

</mapper>
